language: nix
sudo: false
env:
  global:
  - CACHIX_CACHE=jeremiehuchet
  - NUR_REPO=jeremiehuchet
  - secure: ltapaeH0TzUNqGKHepCsz6ES4OlhW7QejYvj1PZUHSZLpZeGCFPOz3UwCKuCBAM8fAPFSRBdW9iMVgGKa0q72PjrUa6s5HXozIQ6qzgjGqgYtX9gXBmyMCnAwfE38E/CrgSWzta1lX5m1zU6Odkwri5gvKzfJkK+8km131CUB5fven/8kC1MTi8503CIGxu/BL7kOrp2s2ITNxir6FXv3778cwnupPK8UPy7Gne8Unf+bET1bh160JolOgspRC3uKYGVfkLLL3jesH7oP0eWDU8JLKOZP6NmJa4ZD8Q4GkCyDSuHOqEbMcZBfUiAH840Nw3He4xwRBk24zwCZrDCdaTPxVJPHUUfHXm4B7sjG4Z1Lwq3wx6VNoknoVg9aWbuWCEm/mECWKf42h/DbvDw8BJ6yE11/BFzamfZRvanMxdNeMcI+fWRj86y8BOnNFZr5/xJg/rv9AKEJkdM7zJjLuK+18mQoXQUMTvcBh3sYWUeCs8vpP87CUhAi3e6F2p1t8QDAl/op+Zy+nvFgZRvloFjO2DB0yfxZ6DWQMmx80b8wDGzLwjU/qaDqSAOh1+KQZ2QXZbW2NQ/cyAKMuBjCyl9k+3L3L0crfM2C24n9w3iVuYdESqMQmzWgSJ4ZHd1RwtW79WAVjgsAZqiP1+lvv+dK51VOTXbNXsHqtfpOjc=
matrix:
  include:
  - env: NIX_CHANNEL=https://nixos.org/channels/nixpkgs-unstable
  - env: NIX_CHANNEL=https://nixos.org/channels/nixos-unstable
  - env: NIX_CHANNEL=https://nixos.org/channels/nixos-19.09
  - env: NIX_CHANNEL=https://nixos.org/channels/nixos-20.03
install:
- nix --version
- if [ -n "${CACHIX_CACHE}" ]; then travis_retry nix-channel --update; fi
- if [ -n "${CACHIX_CACHE}" ]; then nix-env -iA cachix -f https://cachix.org/api/v1/install; fi
- if [ -n "${CACHIX_CACHE}" ]; then cachix use "${CACHIX_CACHE}"; fi
- nix-channel --add "${NIX_CHANNEL}" nixpkgs
- travis_retry nix-channel --update
script:
- nix-build ci.nix -A buildOutputs
- nix eval -f default.nix 'lib'
- nix eval -f default.nix 'modules'
- nix eval -f default.nix 'overlays'
after_success:
- if [ -n "${CACHIX_CACHE}" ]; then nix-build ci.nix -A cacheOutputs | cachix push "${CACHIX_CACHE}"; fi
- if [ "cron" != "${TRAVIS_EVENT_TYPE}" -a "false" = "${TRAVIS_PULL_REQUEST}" -a "master" = "${TRAVIS_BRANCH}" ]; then
      curl -XPOST "https://nur-update.herokuapp.com/update?repo=${NUR_REPO}"; fi
